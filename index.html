async function audit() {
            const file = document.getElementById('f').files[0];
            if(!file) return alert("Select a PDF!");

            document.getElementById('L').classList.remove('hidden');
            document.getElementById('R').classList.add('hidden');

            try {
                const ab = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(ab).promise;
                let t = "";
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    t += content.items.map(s => s.str).join(" ");
                }

                const k = "AIzaSyCfMGe_T6wFyf9MP-gKIjc02uOyE3YAA6Y";
                // We use gemini-1.5-flash-latest for better stability
                const api = `https://corsproxy.io/?${encodeURIComponent("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=" + k)}`;

                const res = await fetch(api, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: "Audit this SA contract for POPIA/BCEA risks: " + t }] }] })
                });

                const d = await res.json();
                
                // --- NEW SAFETY CHECK ---
                if (d.error) {
                    throw new Error("Google API Error: " + d.error.message);
                }

                if (!d.candidates || d.candidates.length === 0) {
                    throw new Error("No response from AI. It might be blocked by safety filters.");
                }

                const output = d.candidates[0].content.parts[0].text;
                document.getElementById('R').innerText = output;
                document.getElementById('R').classList.remove('hidden');

            } catch (e) {
                // This will tell us EXACTLY what is wrong
                alert("DEBUG INFO: " + e.message);
                console.error(e);
            }
            document.getElementById('L').classList.add('hidden');
        }
